## LAB DESCRIPTION

<img width="930" height="530" alt="image" src="https://github.com/user-attachments/assets/1a39349f-51a2-4dbf-acd9-8aa50464c8e1" />

## SOLUTION

---------------------------------------------

- Reference: https://portswigger.net/web-security/csrf

---------------------------------------------

- Login as the provided user `wiener:peter` and go to **My account** -> **Update email**.

<img width="1711" height="695" alt="image" src="https://github.com/user-attachments/assets/5ac8cafe-d15d-4a1e-b316-ad69488d423d" />

- With Burp running, change the email to a dummy email and intercept the request.

  <img width="1220" height="418" alt="image" src="https://github.com/user-attachments/assets/1cab1f49-8f35-4665-8c37-9e41ed16faa6" />

-----------------------------------------------

Now we'll test the CSRF token:

- Modify `CSRF` token and resend -> server responds "Invalid CSRF token".

  <img width="1235" height="539" alt="image" src="https://github.com/user-attachments/assets/59d8c0cb-fe49-4c49-bf2b-aaf98549e709" />

- Remove the `CSRF` parameter entirely and resend as POST -> server again rejects the request.

  <img width="1233" height="539" alt="image" src="https://github.com/user-attachments/assets/5f17da66-eb80-4534-9fb8-f6a9fcbbc28c" />

Conclusion: The server validates the CSRF token for POST requests.

----------------------------------------------------------

## Convert the POST to GET and test token bypass

Next, we'll check whether the same action works over GET without token validation.

1. In Burp Repeater, take the working POST and transform it into a GET:

   <img width="1602" height="1052" alt="image" src="https://github.com/user-attachments/assets/7b588bce-e9cc-4085-8e52-403b597b64c0" />

    After changing the request method, send the request to Repeater.

   <img width="1606" height="1052" alt="image" src="https://github.com/user-attachments/assets/a52d0f17-57bf-41df-a89c-4a94d3af89f3" />

    We get a redirection code; hence the email has been changed

   <img width="731" height="327" alt="image" src="https://github.com/user-attachments/assets/93374328-0f0c-4f4d-ab7f-90fa464f5af4" />


**Conclusion** : 
- POST `/my-account/change-email` -> CSRF token required and validated.
- GET `/my-account/change-email` -> CSRF token ignored; action succeeds without it.

--------------------------------------------------------------

## Use the exploit server to deliver the attack

1. Open the **Exploit server** link in the lab.
2. Paste the PoC HTML into the **Body** field.

```html
   <html>
	<body>
		<img src="https://0acc002704e2b2c281574df800c2000a.web-security-academy.net/my-account/change-email?email=test@evil.net">
	</body>
<html>
```
  
3. Click **Store**


<img width="1712" height="1071" alt="image" src="https://github.com/user-attachments/assets/f5e75fcc-d013-4b4a-9df1-b34966fff0a7" />

4. Finally, click **Deliver exploit to victim** to send it to the simulated victim. When the victims browser loads the exploit, their email is changed, and the lab is marked as solved.

   <img width="1716" height="244" alt="image" src="https://github.com/user-attachments/assets/eba9ad67-1694-41cf-b235-6b26bb52ce44" />
