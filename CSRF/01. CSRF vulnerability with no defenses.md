## LAB DESCRIPTION

<img width="910" height="472" alt="image" src="https://github.com/user-attachments/assets/434d68ae-ea82-4953-930e-4ec31fe50814" />

## SOLUTION

---------------------------------------------

- Reference: https://portswigger.net/web-security/csrf

---------------------------------------------

- Login as the provided user `wiener:peter` and go to **My account** -> **Update email**.

<img width="1348" height="614" alt="image" src="https://github.com/user-attachments/assets/756d9b42-2523-4a1a-9401-987b846eef1a" />

- With Burp running, change the email to a dummy email and intercept the request.

<img width="1342" height="600" alt="image" src="https://github.com/user-attachments/assets/7080e4f0-d754-41d8-b51f-7d831c612d12" />

> Request:    <img width="1228" height="379" alt="image" src="https://github.com/user-attachments/assets/5ec33e99-37ee-46f7-8066-98da0dfdfa73" />

## Key observations:

  - Session authentication is entirely via the `session` cookie, which the browser will include automatically on cross-site request.
  - No CSRF token or extra secret value.

## Building the CSRF exploit HTML

A CSRF attack just needs to replicate this POST from an attacker-controlled page. So, Using the captured request as a template, we will craft an HTML form that:

  - Uses a POST method and has `action` pointing to `/my-account/change-email`.
  - Contains a hidden `email` field with the attacker-chosen email for the victim.

When the victim visits this page while logged in to the lab site, their browser automatically includes the `session cookie` with the POST to `/my-account/change-email`.
The server sees a valid authenticated request and updates the victim's email address to `evil@user.com`.

``` HTML
<form method="POST" action="https://0a660078045db94b8034676000d5008e.web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="evil@user.com">
</form>
<script>
        document.forms[0].submit();
</script>
```

## Using the Portswigger exploit server to deliver the attack

PortSwigger provides an exploit server for hosting our CSRF payload for this lab.

Steps:
>   - Open the **Exploit Server** from the lab.
>   - Paste the exploit HTML into the body field.

> <img width="1713" height="1067" alt="image" src="https://github.com/user-attachments/assets/576f4583-1339-4fe9-9773-d69240638d45" />

>   - Click **Store** to save it.
>   - Click **View exploit** to test against your own session (wiener)


>   - After loading, go back to **My account** and verify that your email is now changed to `evil@user.com`.
>   - Click **Deliver exploit to victim** to send it to the victim user.
>
>   - The victim's browser loads the exploitm, auto-submits the form with their cookies, and the lab maks as solved once their email changes.

> <img width="1723" height="685" alt="image" src="https://github.com/user-attachments/assets/cfac1abe-b8aa-4b8f-aeea-195355dda7d2" />

